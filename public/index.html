<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
</head>
<body>
	<canvas id="canvas"></canvas>
	<script type="text/javascript" src="js/app.js">
	</script>
	<script type="text/javascript">
		app.width = window.innerWidth;
		app.height = window.innerHeight;
		var player1score = 0;
		var player2score = 0;
		function redBoxInput(e){
			if(e.key === 'w'){
					app.getNode('red-box').direction = -1;
				}
				if(e.key === 's'){
					app.getNode('red-box').direction = 1;
				}
		}
		function noRedBoxInput(e){
			if(e.key === 'w' || e.key === 's'){
					app.getNode('red-box').direction = 0;
				}
		}
		function blackBoxInput(e){
			if (e.key === 'ArrowUp') {
				app.getNode('black-box').direction = -1;
			}
			if (e.key === 'ArrowDown') {
				app.getNode('black-box').direction = 1;
			}
		}
		function noBlackBoxInput(e){
			if(e.key === 'ArrowUp' || e.key === 'ArrowDown'){
					app.getNode('black-box').direction = 0;
				}
		}
		app.reset = function(){
			for (var index in app.nodes) {
				var node = app.nodes[index];
				if (node.id == 'ball') {
					app.getNode(node.id).x = app.width/2 - app.getNode(node.id).width/2;

					app.getNode(node.id).direction*=-1;
				}
				else {
					app.getNode(node.id).direction = 0;
				}
				app.getNode(node.id).y = app.height / 2 - app.getNode(node.id).height / 2;
			}

		}
		app.onInit = function(){

			app.canvas.width = window.innerWidth;
			app.canvas.height = window.innerHeight;

			var body = document.getElementById('body');
			body.width = '100%';
			body.height = '100%';
			body.margin = '0px';
			body.overflow = 'hidden';
			body.diplay = 'block';
			this.nodes.push({
				id : 'red-box',
				width  : 50,
				height : 100,
				x  : 0,
				color  : 'red',
				direction : 0
			});

			this.nodes.push({
				id : 'black-box',
				width  : 50,
				height : 100,
				color  : 'black',
				direction : 0
			});
			this.getNode('black-box').x = this.width-this.getNode('black-box').width;
			this.nodes.push({
				id : 'ball',
				width  : 20,
				height : 20,
				color  : 'green',
				direction : -1

			});
			app.reset();
			this.renderTexts.push({
				id: 'player score',
				x: 50,
				y:50,
				font: '48px impact',
				textString: 'player 1: 0 player 2: 0',
				color: 'black'
			});
			window.addEventListener('keydown',redBoxInput,false);
			window.addEventListener('keyup',noRedBoxInput,false);

			window.addEventListener('keydown',blackBoxInput,false);
			window.addEventListener('keyup',noBlackBoxInput,false);

			window.addEventListener('keydown',(e)=>{
				if(e.key === ' '){
					app.pause();
				}
			})
		};

		function collision(collA,collB){
			return !(app.getNode(collB).x>app.getNode(collA).x+app.getNode(collA).width
			|| app.getNode(collA).x>app.getNode(collB).x+app.getNode(collB).width
			|| app.getNode(collB).y>app.getNode(collA).y+app.getNode(collA).height
			|| app.getNode(collA).y>app.getNode(collB).y+app.getNode(collB).height);
		}
		function clamp(curr, min, max){
			return Math.min(Math.max(curr, min), max);
		}
		app.onUpdate = function(time){
			this.getNode('black-box').y = clamp(this.getNode('black-box').y+this.getNode('black-box').direction*time,
												0,
												app.height-this.getNode('black-box').height);

			this.getNode('red-box').y = clamp(this.getNode('red-box').y+this.getNode('red-box').direction*time,
												0,
												app.height-this.getNode('red-box').height);

			var ballSpeed = 0.3;
			this.getNode('ball').x+=this.getNode('ball').direction*time*ballSpeed;
			
			if(collision('red-box','ball') ||collision('black-box','ball')){
				this.getNode('ball').direction*=-1;
			}

			if(this.getNode('ball').x+this.getNode('ball').width<0){
				this.getRenderText('player score').textString = ("player 1: "+(player1score) + " player 2: "+(++player2score));
				app.reset();
			}
			else if(this.getNode('ball').x>this.width){
				this.getRenderText('player score').textString =("player 1: "+(++player1score) + " player 2: "+(player2score));
				app.reset();
			}
		};
	</script>
</body>
</html>